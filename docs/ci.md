# CI/CD Pipeline Guide for CVAI Turbo

This document outlines the Continuous Integration/Continuous Delivery (CI/CD) pipeline established for the CVAI Turbo project. The pipeline is designed to ensure code quality, detect regressions early, and provide fast feedback to developers.

## üöÄ CI Platform: GitHub Actions

Our CI/CD pipeline is implemented using GitHub Actions, integrated directly with our GitHub repository.

## üõ†Ô∏è Pipeline Stages

The pipeline consists of the following stages, executed sequentially:

1.  **Lint (`lint` job):**
    *   **Purpose:** Ensures code quality and adherence to styling standards using linters (e.g., ESLint). Catches potential errors and inconsistencies before tests run.
    *   **Duration Goal:** < 2 minutes

2.  **Test (`test` job):**
    *   **Purpose:** Executes the end-to-end (E2E) test suite using Playwright. This stage is designed for speed and parallelism.
    *   **Parallel Sharding:** Tests are split into 4 parallel jobs (shards) to significantly reduce overall execution time. Each shard runs a subset of the tests.
    *   **Duration Goal (per shard):** < 10 minutes

3.  **Burn-in (`burn-in` job):**
    *   **Purpose:** Crucial for detecting flaky (non-deterministic) tests. This job runs the entire test suite multiple times (10 iterations) to expose intermittent failures that might not appear in a single run.
    *   **Execution Trigger:** Primarily runs on Pull Requests targeting `main` or `develop` branches, and on a weekly cron schedule to proactively identify flakiness.
    *   **Duration Goal:** < 30 minutes

4.  **Report (`report` job):**
    *   **Purpose:** Aggregates results from the test and burn-in stages, provides a summary, and handles artifact management.

## ‚ö° Performance Optimization

To achieve fast feedback and efficient resource utilization, the pipeline incorporates:

*   **Dependency Caching:** `npm` dependencies and Playwright browser binaries are cached between runs, significantly reducing setup time.
*   **Parallel Test Execution:** The `test` stage shards the E2E tests across 4 parallel jobs.
*   **Failure-Only Artifacts:** Test traces, screenshots, and videos are uploaded only when tests fail, saving storage and improving performance for successful runs.

**Overall Pipeline Performance Target:** < 45 minutes (achieving a significant speedup compared to sequential execution).

## üìä Artifact Collection

To aid debugging and analysis, the pipeline collects artifacts:

*   **Test Results (`test-results/`):** Contains the raw test output (e.g., JUnit XML reports).
*   **Playwright Report (`playwright-report/`):** Contains the comprehensive HTML report generated by Playwright.
*   **Traces:** Playwright's powerful trace viewer provides a detailed step-by-step recording of test execution, including network calls, DOM snapshots, and console logs.
*   **Screenshots:** Captured automatically on test failure.
*   **Videos:** Retained on test failure.

These artifacts are uploaded if a job fails and are retained for 30 days.

## üîç Helper Scripts

Several helper scripts are provided in the `scripts/` directory to facilitate local development and debugging:

*   **`scripts/test-changed.sh`:** Runs only the E2E tests related to recently changed files, providing faster local feedback.
*   **`scripts/ci-local.sh`:** Mirrors the CI pipeline locally (lint, tests, reduced burn-in iterations) to help debug CI failures without pushing to the remote repository.

## üîë Secrets Management

The CI pipeline may require access to sensitive information, such as API keys or environment variables (e.g., `BASE_URL`, `API_URL` for the running application).

These should be configured as **GitHub Secrets** in your repository settings (`Settings > Secrets and variables > Actions > Repository secrets`).
**NEVER** hardcode sensitive information directly into the workflow files.

Refer to `docs/ci-secrets-checklist.md` for a list of specific secrets that might be required.

## ‚ñ∂Ô∏è Local CI Mirror

To debug CI failures or to quickly verify the pipeline's behavior locally, you can use the `ci-local.sh` script:

```bash
# Ensure the script is executable
chmod +x scripts/ci-local.sh

# Run the local CI mirror
./scripts/ci-local.sh
```

This will execute a condensed version of the CI pipeline stages on your local machine.

---

_Generated by Murat (Master Test Architect) on 2025-12-02_
